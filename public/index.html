<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game of Life</title>
    <link rel="stylesheet" type="text/css" href="./css/style.css">
</head>
<body>
    <h1>Game of Life</h1>
    <p>The Game of Life is not your typical computer game. It is a 'cellular automaton', and was invented by Cambridge
        mathematician John Conway.</p>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <form>
        <select id="shapes" onchange="loadShape(this.value)">
            <option>Clear</option>
            <option>Glider</option>
            <option>Small Exploder</option>
            <option>10 Cell Row</option>
        </select>
        <button type="button" onclick="simulate()">Next</button>
        <input id="days" type="number" value="1" min="1" size="1"/>
        <input id="speed" type="range" step="1" min="1" max="10"/>
    </form>

    <!--<script src="./js/game.js" type="text/javascript"></script>-->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        ctx.strokeStyle = 'black';
        ctx.fillStyle = 'blue';
        const sqrSize = 20;
        canvas.addEventListener('click', onMouseClick, false);

        function setEventHandlers() {
            socket.on('boardChanged', onBoardChanged);
        }

        function onBoardChanged(board) {
            draw(board);
            console.log('Board changed');
        }

        function draw(board) {

            ctx.clearRect(0, 0, 600, 600);
            board.forEach(function(row, x) {
                row.forEach(function(cell, y) {
                    ctx.beginPath();
                    ctx.rect(y*sqrSize, x*sqrSize, sqrSize, sqrSize);
                    if (cell) {
                        ctx.fill();
                    } else {
                        ctx.stroke();
                    }
                });
            });
        }

        function loadShape(shape) {
            socket.emit('loadShape', shape);
        }

        function simulate() {
            const days = parseInt(document.getElementById('days').value);
            const speed = parseInt(document.getElementById('speed').value);
            socket.emit('simulate', {days, speed});
        }

        function onMouseClick(event) {
            const rect = canvas.getBoundingClientRect();
            const y = Math.floor((event.clientX - rect.left) / sqrSize);
            const x = Math.floor((event.clientY - rect.top) / sqrSize);
            console.log(x, y);
            socket.emit('newCell', {x, y});
        }
        setEventHandlers();
    </script>
</body>
</html>